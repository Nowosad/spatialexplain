<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An introduction to spatial explanations • spatialexplain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to spatial explanations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spatialexplain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/An-introduction-to-spatial-explanations.html">An introduction to spatial explanations</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-break-down.html">Spatial break-down</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-LIME.html">Spatial LIME</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-oscillations.html">Spatial oscillations</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-SHAP.html">Spatial SHAP</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="An-introduction-to-spatial-explanations_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An introduction to spatial explanations</h1>
                        <h4 data-toc-skip class="author">Jakub Nowosad</h4>
            
            <h4 data-toc-skip class="date">2024-11-20</h4>
      

      <div class="d-none name"><code>An-introduction-to-spatial-explanations.Rmd</code></div>
    </div>

    
    
<p>The <strong>spatialexplain</strong> package provides model agnostic tools for exploring and explaining spatial machine learning models. The goal of this vignette is to show the basic workflow of its usage.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The modeling part of the vignette is very simplified to focus on the &lt;strong&gt;spatialexplain&lt;/strong&gt; package capabilities.&lt;/p&gt;"><sup>1</sup></a></p>
<p>Let’s start by attaching the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spatialexplain</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/DALEX/" class="external-link">DALEX</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we load two spatial datasets. The first one is a spatial vector point dataset with annual average air temperature measurements in Celsius for Spain in 2019. The second one is a raster dataset with predictors, such as population density (<code>popdens</code>), distance to the coast (<code>coast</code>), elevation (<code>dem</code>), a satellite-based Normalized Difference Vegetation Index (<code>ndvi</code>), and annual average composites of the Land Surface Temperature product for day (<code>lst_day</code>) and night (<code>lst_night</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_train</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"/vsicurl/https://github.com/Nowosad/IIIRqueR_workshop_materials/raw/refs/heads/main/data/temp_train.gpkg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span></span></code></pre></div>
<p><img src="An-introduction-to-spatial-explanations_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">predictors</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"/vsicurl/https://github.com/Nowosad/IIIRqueR_workshop_materials/raw/refs/heads/main/data/predictors.tif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predictors</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="An-introduction-to-spatial-explanations_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>To prepare the data for the model, we need to extract the values of the predictors at the locations of the temperature measurements with <code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract()</a></code>, and then combine them with the temperature measurements with <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="va">temp_train</span>, ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">temp_train</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">temp_train</span>, <span class="va">temp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 825940.4 ymin: 4541533 xmax: 934920.7 ymax: 4630234</span></span>
<span><span class="co">#&gt; Projected CRS: ED50 / UTM zone 30N</span></span>
<span><span class="co">#&gt;       temp      popdens      coast        dem      ndvi  lst_day lst_night</span></span>
<span><span class="co">#&gt; 1 17.52610     0.000000  1.1263009  85.905403 0.3656146 24.37792 12.642557</span></span>
<span><span class="co">#&gt; 2 16.94795     1.211701  6.7432733  75.001259 0.3990190 28.13341 10.706681</span></span>
<span><span class="co">#&gt; 3 17.49233     5.681698  1.7549587   2.556155 0.1987631 25.76198 11.370279</span></span>
<span><span class="co">#&gt; 4 15.30838  4752.076660 45.7688789 256.110870 0.3861388 26.97013  8.315234</span></span>
<span><span class="co">#&gt; 5 16.56247  1789.268799  6.2198448 303.596924 0.5917153 22.47704 12.101181</span></span>
<span><span class="co">#&gt; 6 17.22139 13260.116211  0.7378924  12.070770 0.2349442 24.79462 13.021243</span></span>
<span><span class="co">#&gt;                       geom</span></span>
<span><span class="co">#&gt; 1 POINT (825940.4 4541533)</span></span>
<span><span class="co">#&gt; 2 POINT (849548.2 4563427)</span></span>
<span><span class="co">#&gt; 3 POINT (924683.3 4583884)</span></span>
<span><span class="co">#&gt; 4 POINT (902776.4 4630234)</span></span>
<span><span class="co">#&gt; 5 POINT (928394.5 4598097)</span></span>
<span><span class="co">#&gt; 6 POINT (934920.7 4595391)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="regression-model">Regression model<a class="anchor" aria-label="anchor" href="#regression-model"></a>
</h2>
<p>Now, we can build models that predict the temperature based on the predictors. The first one is a regression model that predicts the temperature in Celsius for the whole area of the <code>predictors</code> raster. Many modeling methods and R tools can be used to build the model, but in this vignette, we use the <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> function from the <strong>rpart</strong> package, which builds a regression tree model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rpart_model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rpart_model</span></span>
<span><span class="co">#&gt; n= 195 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; node), split, n, deviance, yval</span></span>
<span><span class="co">#&gt;       * denotes terminal node</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  1) root 195 1546.773000 15.101570  </span></span>
<span><span class="co">#&gt;    2) lst_night&lt; 7.545278 70  286.239700 12.218960  </span></span>
<span><span class="co">#&gt;      4) dem&gt;=1271.976 9   15.529640  8.157678 *</span></span>
<span><span class="co">#&gt;      5) dem&lt; 1271.976 61  100.362400 12.818160  </span></span>
<span><span class="co">#&gt;       10) lst_day&lt; 27.41322 52   52.454960 12.469420  </span></span>
<span><span class="co">#&gt;         20) lst_night&lt; 5.956942 35   21.516320 11.993630 *</span></span>
<span><span class="co">#&gt;         21) lst_night&gt;=5.956942 17    6.703209 13.448980 *</span></span>
<span><span class="co">#&gt;       11) lst_day&gt;=27.41322 9    5.042911 14.833110 *</span></span>
<span><span class="co">#&gt;    3) lst_night&gt;=7.545278 125  353.141300 16.715830  </span></span>
<span><span class="co">#&gt;      6) lst_night&lt; 10.0302 69   92.904980 15.557040  </span></span>
<span><span class="co">#&gt;       12) lst_day&lt; 25.98267 24   13.758720 14.412790 *</span></span>
<span><span class="co">#&gt;       13) lst_day&gt;=25.98267 45   30.963710 16.167310 *</span></span>
<span><span class="co">#&gt;      7) lst_night&gt;=10.0302 56   53.423460 18.143620 *</span></span></code></pre></div>
<p>Next, we can use the <code><a href="https://modeloriented.github.io/DALEX/reference/explain.html" class="external-link">explain()</a></code> function from the <strong>DALEX</strong> package to create an explainer object for the model. Explainer is a universal model wrapper that can be used to explain any model with the same set of tools.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The &lt;strong&gt;DALEX&lt;/strong&gt; package allows explaining models created with &lt;strong&gt;keras&lt;/strong&gt;, &lt;strong&gt;parsnip&lt;/strong&gt;, &lt;strong&gt;caret&lt;/strong&gt;, &lt;strong&gt;mlr&lt;/strong&gt;, &lt;strong&gt;H2O&lt;/strong&gt;, &lt;strong&gt;xgboost&lt;/strong&gt;, and many others. Moreover, its extension &lt;strong&gt;DALEXtra&lt;/strong&gt; allows explaining models created with &lt;strong&gt;xgboost&lt;/strong&gt;, &lt;strong&gt;mlr&lt;/strong&gt;, &lt;strong&gt;mlr3&lt;/strong&gt;, &lt;strong&gt;tidymodels&lt;/strong&gt;, and even Python’s &lt;strong&gt;scikit-learn&lt;/strong&gt; and &lt;strong&gt;keras&lt;/strong&gt; and Java’s &lt;strong&gt;h2o&lt;/strong&gt;.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regr_exp</span> <span class="op">=</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/explain.html" class="external-link">explain</a></span><span class="op">(</span><span class="va">rpart_model</span>,</span>
<span>                   data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">temp_train</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated</span></span>
<span><span class="co">#&gt;   -&gt; model label       :  rpart  (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; data              :  195  rows  6  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  195  values </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  yhat.rpart  will be used (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package rpart , ver. 4.1.23 , task regression (  default  ) </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  8.157678 , mean =  15.10157 , max =  18.14362  </span></span>
<span><span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; residuals         :  numerical, min =  -3.09541 , mean =  1.512235e-15 , max =  2.473572  </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<p>This explainer can be used to check various instance and dataset-level explanations of the model, such as partial dependence plots and feature importance.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Read the &lt;a href="https://ema.drwhy.ai/" class="external-link"&gt;"Biecek, P., &amp;amp; Burzykowski, T. (2021). Explanatory model analysis: explore, explain, and examine predictive models. Chapman and Hall/CRC.&lt;/a&gt; book for more details.&lt;/p&gt;'><sup>3</sup></a> However, these methods usually do not inform us about the spatial distribution of the model predictions. This is where the <strong>spatialexplain</strong> package comes in. It has a function called <code><a href="../reference/predict_spatial_parts.html">predict_spatial_parts()</a></code> that can be used to calculate the attributions of the model (Break Down, SHAP, or Oscillations explanations) for each observation in the raster. The function requires the explainer object and the predictor’s raster. Additionally, as the calculation of the attributions can be computationally expensive, the function has a <code>maxcell</code> parameter that controls the number of cells in the raster that will be used to get the attributions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regr_pps1</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_spatial_parts.html">predict_spatial_parts</a></span><span class="op">(</span><span class="va">regr_exp</span>, <span class="va">predictors</span>, maxcell <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regr_pps1</span><span class="op">)</span></span></code></pre></div>
<p><img src="An-introduction-to-spatial-explanations_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>By default, the <code><a href="../reference/predict_spatial_parts.html">predict_spatial_parts()</a></code> function calculates the Break Down attributions. This method quantifies how each explanatory variable contributes to the model’s average prediction (the ‘intercept’) by assessing the impact on the prediction as values of each variable are fixed in sequence. Each of the cells in the raster is colored according to the contribution of the predictors to the model prediction. Here, we can see that the intercept of the model is 15.1 for the whole area, and that the variables <code>popdens</code>, <code>coast</code>, and <code>ndvi</code> do not have any influence on the model prediction. On the other hand, the variables <code>dem</code>, <code>lst_day</code>, and <code>lst_night</code> affect the model prediction differently, depending on the location. For example, the <code>dem</code> variable has a negative influence on the model prediction in the mountainous areas – the higher the elevation, the lower the temperature.</p>
</div>
<div class="section level2">
<h2 id="classification-model">Classification model<a class="anchor" aria-label="anchor" href="#classification-model"></a>
</h2>
<p>The same workflow can be used for classification models. Here, we build a classification model that predicts if the temperature is cold or hot (below or above 17 degrees Celsius).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_train</span><span class="op">$</span><span class="va">temp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">$</span><span class="va">temp</span>,</span>
<span>                      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">17</span>, <span class="cn">Inf</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cold"</span>, <span class="st">"hot"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We use the <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart()</a></code> function from the <strong>rpart</strong> package to build a classification tree model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rpart_model_clas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rpart_model_clas</span></span>
<span><span class="co">#&gt; n= 195 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">#&gt;       * denotes terminal node</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1) root 195 57 cold (0.70769231 0.29230769)  </span></span>
<span><span class="co">#&gt;   2) lst_night&lt; 10.04327 140  8 cold (0.94285714 0.05714286) *</span></span>
<span><span class="co">#&gt;   3) lst_night&gt;=10.04327 55  6 hot (0.10909091 0.89090909) *</span></span></code></pre></div>
<p>Next, we create an explainer object for the classification model – the code is almost the same as for the regression model, except that we use the classification model here.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clas_exp</span> <span class="op">=</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/explain.html" class="external-link">explain</a></span><span class="op">(</span><span class="va">rpart_model_clas</span>,</span>
<span>                   data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">temp_train</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">temp_train</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated</span></span>
<span><span class="co">#&gt;   -&gt; model label       :  rpart  (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; data              :  195  rows  6  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  195  values </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  yhat.rpart  will be used (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package rpart , ver. 4.1.23 , task classification (  default  ) </span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  Model info detected classification task but 'y' is a factor .  (  WARNING  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  By deafult classification tasks supports only numercical 'y' parameter. </span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  Consider changing to numerical vector with 0 and 1 values.</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  Otherwise I will not be able to calculate residuals or loss function.</span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  0.05714286 , mean =  0.2923077 , max =  0.8909091  </span></span>
<span><span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span><span class="co">#&gt; Warning in Ops.factor(y, predict_function(model, data)): '-' not meaningful for</span></span>
<span><span class="co">#&gt; factors</span></span>
<span><span class="co">#&gt;   -&gt; residuals         :  numerical, min =  NA , mean =  NA , max =  NA  </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<p>Finally, we can calculate the attributions for the classification model using the <code><a href="../reference/predict_spatial_parts.html">predict_spatial_parts()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clas_pps1</span> <span class="op">=</span> <span class="fu"><a href="../reference/predict_spatial_parts.html">predict_spatial_parts</a></span><span class="op">(</span><span class="va">clas_exp</span>, <span class="va">predictors</span>, maxcell <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">clas_pps1</span><span class="op">)</span></span></code></pre></div>
<p><img src="An-introduction-to-spatial-explanations_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>The classification model is much simpler in this case.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Importantly, we did not consider the quality of the models in this vignette. In the real-world scenario, the model should be validated using cross-validation, and the quality of the model should be assessed using various metrics.&lt;/p&gt;"><sup>4</sup></a> The average prediction of the model is <code>0.292</code> for the whole area, meaning that the probability of the temperature being hot is <code>0.292</code>. Then, only the <code>lst_night</code> variable has an impact on the model prediction, with the higher values of the variable increasing the probability of the temperature being hot. We can find such areas in the south of Spain and along its eastern coast.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
