<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Predict SHAP — map_shap • spatialexplain</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predict SHAP — map_shap"><meta name="description" content="This function calculates the attributions of the model
(SHAP explanations) for each observation in the raster.
Model predictions are decomposed into parts that are attributed for particular variables,
and then the attributions are assigned to the corresponding cells in the raster.
See the documentation of the DALEX::predict_parts() function for more details."><meta property="og:description" content="This function calculates the attributions of the model
(SHAP explanations) for each observation in the raster.
Model predictions are decomposed into parts that are attributed for particular variables,
and then the attributions are assigned to the corresponding cells in the raster.
See the documentation of the DALEX::predict_parts() function for more details."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spatialexplain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/An-introduction-to-spatial-explanations.html">An introduction to spatial explanations</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-break-down.html">Spatial break-down</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-LIME.html">Spatial LIME</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-oscillations.html">Spatial oscillations</a></li>
    <li><a class="dropdown-item" href="../articles/Spatial-SHAP.html">Spatial SHAP</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nowosad/spatialexplain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Predict SHAP</h1>
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/spatialexplain/blob/main/R/map_shap.R" class="external-link"><code>R/map_shap.R</code></a></small>
      <div class="d-none name"><code>map_shap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates the attributions of the model
(SHAP explanations) for each observation in the raster.
Model predictions are decomposed into parts that are attributed for particular variables,
and then the attributions are assigned to the corresponding cells in the raster.
See the documentation of the <code><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">DALEX::predict_parts()</a></code> function for more details.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">map_shap</span><span class="op">(</span><span class="va">explainer</span>, <span class="va">raster_obs</span>, maxcell <span class="op">=</span> <span class="fl">1000</span>, <span class="va">...</span>, N <span class="op">=</span> <span class="cn">NULL</span>, type <span class="op">=</span> <span class="st">"shap"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-explainer">explainer<a class="anchor" aria-label="anchor" href="#arg-explainer"></a></dt>
<dd><p>a model to be explained, preprocessed by the <code><a href="https://modeloriented.github.io/DALEX/reference/explain.html" class="external-link">DALEX::explain()</a></code> function</p></dd>


<dt id="arg-raster-obs">raster_obs<a class="anchor" aria-label="anchor" href="#arg-raster-obs"></a></dt>
<dd><p>a raster object with the observations to be explained (predictors used in the model)</p></dd>


<dt id="arg-maxcell">maxcell<a class="anchor" aria-label="anchor" href="#arg-maxcell"></a></dt>
<dd><p>the maximum number of cells in the raster. If the number of cells in the raster is greater than <code>maxcell</code>, the function will sample <code>maxcell</code> cells from the raster. By default 1000</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other parameters that will be passed to <code><a href="https://ModelOriented.github.io/iBreakDown/reference/break_down.html" class="external-link">iBreakDown::break_down()</a></code></p></dd>


<dt id="arg-n">N<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>the maximum number of observations used for calculation of attributions. By default NULL (use all)</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>the type of variable attributions. Only <code>"shap"</code> is implemented at the moment.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A raster object with the same dimensions as <code>raster_obs</code>. The number of layers equal to the number of variables in the model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lundberg, S. (2017). A unified approach to interpreting model predictions. arXiv preprint arXiv:1705.07874.</p>
<p>Staniak, M., &amp; Biecek, P. (2018). Explanations of model predictions with live and breakDown packages. arXiv preprint arXiv:1804.01955.</p>
<p>Biecek, P., &amp; Burzykowski, T. (2021). Explanatory model analysis: explore, explain, and examine predictive models. Chapman and Hall/CRC.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">predictors_agg</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster/predictors_agg.tif"</span>, package <span class="op">=</span> <span class="st">"spatialexplain"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"regr_exp"</span>, package <span class="op">=</span> <span class="st">"spatialexplain"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">regr_psp_bd</span> <span class="op">=</span> <span class="fu">map_shap</span><span class="op">(</span><span class="va">regr_exp</span>, <span class="va">predictors_agg</span>, maxcell <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regr_psp_bd</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="map_shap-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

